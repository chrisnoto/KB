td-agent配置
[root@es1 td-agent]# cat td-agent.conf |egrep -v '#|^$'
<match td.*.*>
  @type tdlog
  @id output_td
  apikey YOUR_API_KEY
  auto_create_table
  <buffer>
    @type file
    path /var/log/td-agent/buffer/td
  </buffer>
  <secondary>
    @type file
    path /var/log/td-agent/failed_records
  </secondary>
</match>
<match debug.**>
  @type stdout
  @id output_stdout
</match>
<match *.*>
  @type copy
  <store>
    @type elasticsearch
    host 10.67.51.123
    port 9200
    logstash_format true
    logstash_dateformat %Y.%m.%d
    logstash_prefix fluentd
    <buffer>
      @type file
      path /var/log/td-agent/buffer/hostname.buffer
      flush_interval 10s
    </buffer>
  </store>
</match>
<source>
  @type tail
  path /var/log/messages
  pos_file /var/log/td-agent/messages.pos
  tag hostname.message
  <parse>
    @type json
  </parse>
</source>
<source>
  @type debug_agent
  @id input_debug_agent
  bind 127.0.0.1
  port 24230
</source>

########syslog to fluent############
[root@es1 td-agent]# cat td-agent.conf |egrep -v '#|^$'
<match td.*.*>
  @type tdlog
  @id output_td
  apikey YOUR_API_KEY
  auto_create_table
  <buffer>
    @type file
    path /var/log/td-agent/buffer/td
  </buffer>
  <secondary>
    @type file
    path /var/log/td-agent/failed_records
  </secondary>
</match>
<match debug.**>
  @type stdout
  @id output_stdout
</match>
<match syslog.*.*>
  @type copy
  <store>
    @type elasticsearch
    host 10.67.51.123
    port 9200
    logstash_format true
    logstash_dateformat %Y.%m.%d
    logstash_prefix fluentd
    <buffer>
      @type file
      path /var/log/td-agent/buffer/hostname.buffer
      flush_interval 10s
    </buffer>
  </store>
</match>
<source>
  @type syslog
  port 42185
  tag syslog
</source>
<source>
  @type debug_agent
  @id input_debug_agent
  bind 127.0.0.1
  port 24230
</source>

########worker1  tail docker log
<match docker.*.*>
  @type copy
  <store>
    @type elasticsearch
    host 10.67.51.123
    port 9200
    logstash_format true
    logstash_dateformat %Y.%m.%d
    logstash_prefix fluentd
    <buffer>
      @type file
      path /var/log/td-agent/buffer/hostname.buffer
      flush_interval 10s
    </buffer>
  </store>
</match>
<source>
   @type  tail
   path  /var/log/containers/*.log
   pos_file  /var/log/td-agent/docker-logging.pos
   time_format  %Y-%m-%dT%H:%M:%S
   tag  docker
   format  json
   read_from_head  true
</source>


[root@worker2 ~]# cat /etc/docker/daemon.json
{
  "log-driver": "fluentd",
  "log-opts": {
    "fluentd-address": "127.0.0.1:24224",
	"tag": "{{.ImageName}}/{{.Name}}/{{.ID}}"
  }
}
###worker2  docker log-driver fluentd
[root@worker2 ~]# cat /etc/td-agent/td-agent.conf |egrep -v '#|^$'
<match td.*.*>
  @type tdlog
  @id output_td
  apikey YOUR_API_KEY
  auto_create_table
  <buffer>
    @type file
    path /var/log/td-agent/buffer/td
  </buffer>
  <secondary>
    @type file
    path /var/log/td-agent/failed_records
  </secondary>
</match>
<match debug.**>
  @type stdout
  @id output_stdout
</match>
<source>
  @type debug_agent
  @id input_debug_agent
  bind 127.0.0.1
  port 24230
</source>
<match *>
  @type copy
  <store>
    @type elasticsearch
    host 10.67.51.123
    port 9200
    logstash_format true
    logstash_dateformat %Y.%m.%d
    logstash_prefix fluentd
    <buffer>
      @type file
      path /var/log/td-agent/buffer/hostname.buffer
      flush_interval 10s
    </buffer>
  </store>
</match>
<source>
   @type  forward
</source>
